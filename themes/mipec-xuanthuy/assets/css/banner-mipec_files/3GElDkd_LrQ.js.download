if (self.CavalryLogger) { CavalryLogger.start_js(["Q4toA"]); }

__d("VaultEditableGrid",["csx","Arbiter","AsyncRequest","CSS","DOM","Event","Scroll","$","ge","removeFromArray"],(function(a,b,c,d,e,f,g){__p&&__p();var h={};function a(a,c,d,e){__p&&__p();h[a.id]=this;this._grid=a;this._gridID=a.id;this._dialogEndpoint=c;this._collapseWhenEmpty=d;this._attachmentCount=e;this._selectedVaultImageIDs=[];(c=b("Arbiter")).subscribe("multi-upload/image-removed/"+this._gridID,function(a,c){b("removeFromArray")(this._selectedVaultImageIDs,c),this.updateAttachmentCount(this._attachmentCount-1)}.bind(this));c.subscribe("multi-upload/composer-reset/"+this._gridID,function(a,b){this.removeImages()}.bind(this));c.subscribe(["multi-upload/images-upload-start/"+this._gridID,"multi-upload/video-added/"+this._gridID],function(){this.updateAttachmentCount(this._attachmentCount+1)}.bind(this));c.inform("fbVaultEditableGrid/created/"+a.id,this,"persistent");c.subscribe("multi-upload/images-upload-start/"+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount)}Object.assign(a,{VAULT_IMAGE:"vault_image",getInstance:function(a){return h[a]},registerDialogWithGrid:function(a,c,d){b("Arbiter").subscribe(["multi-upload/images-upload-start/"+a,"multi-upload/video-added/"+a],d.hide.bind(d)),b("Arbiter").subscribe("fbVaultEditableGrid/created/"+a,function(a,b){b._registerDialogWithGrid(c,d)})},onImagesSelected:function(a,b,c){h[a]._onImagesSelected(b,c)}});Object.assign(a.prototype,{getRoot:function(){var a=b("ge")(this._gridID);if(a)return a;else return this._grid},_registerDialogWithGrid:function(a,c){__p&&__p();this._dialog=c;var d=this.getMoreLink();d&&b("Event").listen(d,"click",function(){c.show();return!1});c.subscribe("aftershow",function(){var c=[];b("DOM").scry(b("$")(this._gridID),'input[type="hidden"]').forEach(function(a){(a.name.match("composer_vault_images")||a.name.match("composer_unpublished_photo"))&&c.push(a.value)});var d=a.getGrid();d.bulkChange(function(){var a=d.getSelectionSet();a.clear();a.addAll(c)})}.bind(this))},updateAttachmentCount:function(a){this._attachmentCount=a,this._collapseWhenEmpty&&b("CSS").conditionShow(this._grid,this._attachmentCount>0)},getID:function(){return this._gridID},_onImagesSelected:function(a,c){var d=b("DOM").find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=c;a.forEach(function(a){b("DOM").insertBefore(d,a)});b("Arbiter").inform("multi-upload/images-added/"+this._gridID,{fbids:c});this._scrollToRight()},removeImages:function(){b("DOM").scry(this.getRoot(),".fbVaultGridItem").forEach(function(a){b("CSS").hasClass(a,"fbVaultEditableGridMoreLink")||b("DOM").remove(a)}),this._selectedVaultImageIDs=[],b("Arbiter").inform("multi-upload/all-images-removed/"+this._gridID),this.updateAttachmentCount(0)},_scrollToRight:function(){var a=this.getRoot(),c=b("DOM").find(a,".fbScrollableAreaWrap");b("Scroll").setLeft(c,Math.max(0,b("DOM").find(a,".fbScrollableAreaBody").offsetWidth-c.offsetWidth))},showDialog:function(a,c){this._dialog?this._dialog.show():b("AsyncRequest").bootstrap(this._dialogEndpoint,a)},getMoreLink:function(){return b("DOM").scry(this.getRoot(),".fbVaultEditableGridMoreLink")[0]}});e.exports=a}),null);
__d("BasePhotoUploader",["Arbiter","ArbiterMixin","CSS","DOM","PhotosMultiUploadInput","TimelineMapScrollableArea","VaultEditableGrid","getObjectValues","mixin"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d){__p&&__p();var e;e=a.call(this)||this;new(b("TimelineMapScrollableArea"))(c,{verticalscroll:!0});e.$BasePhotoUploader1=c;e.$BasePhotoUploader2=e.$BasePhotoUploader3();e.$BasePhotoUploader4=!1;e.$BasePhotoUploader5=null;d.addSubscriptions(b("Arbiter").subscribe("multi-upload/images-added/"+e.$BasePhotoUploader1.id,function(a,c){a=Object.assign({},c.fbids);Object.assign(this.$BasePhotoUploader2,a);this.$BasePhotoUploader6();this.inform("upload-completed",{fbids:b("getObjectValues")(a)})}.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/image-removed/"+e.$BasePhotoUploader1.id,function(a,b){for(var c in this.$BasePhotoUploader2)if(this.$BasePhotoUploader2[c]===b){delete this.$BasePhotoUploader2[c];break}this.$BasePhotoUploader6()}.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/images-upload-start/"+e.$BasePhotoUploader1.id,function(a,c){b("CSS").show(this.$BasePhotoUploader1),this.$BasePhotoUploader4=!0,this.inform("dom-updated"),this.inform("upload-started",c)}.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/composer-reset/"+e.$BasePhotoUploader1.id,e.clear.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/all-images-removed/"+e.$BasePhotoUploader1.id,e.$BasePhotoUploader7.bind(babelHelpers.assertThisInitialized(e))),b("Arbiter").subscribe("multi-upload/images-upload-completed/"+e.$BasePhotoUploader1.id,function(a){this.$BasePhotoUploader4=!1,this.inform("all-uploads-completed"),this.$BasePhotoUploader6()}.bind(babelHelpers.assertThisInitialized(e))));b("CSS").conditionShow(e.$BasePhotoUploader1,Object.keys(e.$BasePhotoUploader2).length);return e}var d=c.prototype;d.getSelectedFBIDs=function(){var a=this,b=Object.keys(this.$BasePhotoUploader2).sort();return b.map(function(b){return a.$BasePhotoUploader2[b]})};d.isUploading=function(){return this.$BasePhotoUploader4};d.clear=function(){var a=b("VaultEditableGrid").getInstance(this.$BasePhotoUploader1.id);a&&a.removeImages()};d.getWaterfallID=function(){return b("PhotosMultiUploadInput").getWaterfallID(this.$BasePhotoUploader1.id)};d.$BasePhotoUploader7=function(){this.$BasePhotoUploader2={},this.$BasePhotoUploader4=!1,b("CSS").hide(this.$BasePhotoUploader1),this.inform("all-uploads-completed"),this.inform("dom-updated")};d.$BasePhotoUploader3=function(){var a={},c=-1e4;b("DOM").scry(this.$BasePhotoUploader1,'input[type="hidden"]').forEach(function(b){b.name.match("composer_vault_images")&&(a[c]=b.value,c--)});return a};d.$BasePhotoUploader6=function(){b("CSS").conditionShow(this.$BasePhotoUploader1,Object.keys(this.$BasePhotoUploader2).length>0),this.inform("dom-updated")};d.setCurrentMethod=function(a){this.$BasePhotoUploader5=a};d.getCurrentMethod=function(){return this.$BasePhotoUploader5};return c}(b("mixin")(b("ArbiterMixin")));e.exports=a}),null);
__d("MercuryPhotoUploader",["csx","cx","Arbiter","AsyncRequest","BasePhotoUploader","DOM","Event","FileInput","Focus","Parent","PhotosMultiUploadInput","VaultEditableGrid"],(function(a,b,c,d,e,f,g,h){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f){__p&&__p();e=a.call(this,c,e)||this;e.$MercuryPhotoUploader1=c.id;e.$MercuryPhotoUploader2=!1;b("Arbiter").subscribe("PhotosMultiUploadInput/loaded/"+c.id,function(){this.$MercuryPhotoUploader2=!0}.bind(babelHelpers.assertThisInitialized(e)));b("Arbiter").subscribe("MercuryPhotoUploader/initUploadButton/"+c.id,function(){var a=b("DOM").scry(d,'input[type="file"]')[0];a||(a=b("DOM").create("input",{accept:"image/*",type:"file",className:"_n",name:"composer_unpublished_photo[]",multiple:1}));var e=b("Parent").bySelector(d,"._9_h");e=new(b("FileInput"))(e,b("DOM").find(e,"._214"),a);e.subscribe("change",b("PhotosMultiUploadInput").doFileUpload.bind(null,c.id,e))});b("Arbiter").subscribe("MercuryPhotoUploader/registerPhotoMenu/"+c.id,function(a,e){__p&&__p();a=e.menu.getRoot();e.menu.setContext(d);var f=b("DOM").scry(a,"._d2p"),g=f&&f[0];g&&b("Event").listen(g,"click",function(){b("VaultEditableGrid").getInstance(c.id).showDialog(g,b("VaultEditableGrid").VAULT_IMAGE),this.setCurrentMethod("vault"),this.inform("selection-start",{method:"vault"})}.bind(this));b("Event").listen(d,"click",function(){if(!this.$MercuryPhotoUploader2)return;if(!e.menu.isShown()){var a=b("DOM").scry(e.menu.getContentRoot(),"li");this.inform("menu-show");e.menu.show();a&&b("Focus").setWithoutOutline(a[0])}else this.inform("menu-hide"),e.menu.hide()}.bind(this));b("Event").listen(document.documentElement,"click",function(a){!b("DOM").contains(d,a.getTarget())&&!b("DOM").contains(g,a.getTarget())&&(e.menu.isShown()&&this.inform("menu-hide"),e.menu.hide())}.bind(this));f=b("DOM").find(a,"._9_h");b("Event").listen(f,"click",function(){this.setCurrentMethod("file_selector"),this.inform("selection-start",{method:"file_selector"})}.bind(this))}.bind(babelHelpers.assertThisInitialized(e)));f&&b("PhotosMultiUploadInput").initDragDrop(c.id,f);return e}var d=c.prototype;d.uploadPastedFile=function(a){b("PhotosMultiUploadInput").onFilesDrop(this.$MercuryPhotoUploader1,[a])};d.addCachedPhotos=function(a){b("AsyncRequest").post("/ajax/vault/selected.php",{max_select:10,grid_id:this.$MercuryPhotoUploader1,source:"messenger",image_ids:a})};return c}(b("BasePhotoUploader"));Object.assign(a,{initUploadButton:function(a){b("Arbiter").inform("MercuryPhotoUploader/initUploadButton/"+a,{},"persistent")},registerPhotoMenu:function(a,c){b("Arbiter").inform("MercuryPhotoUploader/registerPhotoMenu/"+a,{menu:c},"persistent")}});e.exports=a}),null);
__d("MercuryDataSources",[],(function(a,b,c,d,e,f){var g={};a={add:function(a,b){g[a]=b},get:function(a){!g[a];return g[a]}};e.exports=a}),null);
__d("MercuryTypeaheadCore",["Event","Keys","TypeaheadCore"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){var c;c=a.call(this,b)||this;c.showDefaultOnNoInput=!1;c.showDefaultOnNoInput=b.showDefaultOnNoInput||!1;return c}var d=c.prototype;d.initData=function(){var b=this;a.prototype.initData.call(this);this.showDefaultOnNoInput&&(this.data.subscribe("show-default",function(){b.getValue()==""&&!b.element.disabled&&b.data.defaultList&&b.view.render("",b.data.defaultList,!1)}),this.data.defaultList&&this.view.render("",this.data.defaultList,!1))};d.keyup=function(c){a.prototype.keyup.call(this);if(this.getValue().length===0&&this.showDefaultOnNoInput){switch(b("Event").getKeyCode(c)){case b("Keys").ESC:return}this.data.showDefaultList&&this.data.inform("show-default")}};d.focus=function(){var b=!1;this.view.isVisible()||(b=!0);a.prototype.focus.call(this);if(!b)return;this.view.isVisible()&&this.data.showDefaultList&&this.getValue().length===0&&this.data.inform("show-default")};d.click=function(){this.getValue().length===0&&this.view.isVisible()&&this.data.showDefaultList&&this.data.inform("show-default"),a.prototype.click.call(this)};return c}(b("TypeaheadCore"));e.exports=a}),null);
__d("MercuryTypeahead",["cx","ArbiterMixin","DOM","DOMDimensions","Event","Input","Keys","MercuryConfig","MercuryTypeaheadCore","MercuryTypeaheadTemplates","Tokenizer","Typeahead"],(function(a,b,c,d,e,f,g){__p&&__p();a=function(a,c){this._domElement=null,this._typeahead=null,this._tokenizer=null,this._placeholder="",this._exclusions=[],this._viewNodeOrID=null,this._viewOptions={renderer:"compact",autoSelect:!b("MercuryConfig").ChatComposer},this._tokenizerBehaviors=[],this._heightPrev=null,this._dataSource=a,this._view=c};Object.assign(a.prototype,b("ArbiterMixin"));Object.assign(a.prototype,{setPlaceholder:function(a){this._placeholder=a;return this},setExcludedParticipantsFromThreadMeta:function(a){if(!a)return;this.setExcludedParticipants(a.participants)},setExcludedParticipants:function(a){this._exclusions=[];a.forEach(function(a){var b=a.indexOf(":");a.substr(0,b)=="fbid"&&this._exclusions.push(a.substr(b+1))}.bind(this));return this},setViewNodeID:function(a){this._viewNodeOrID=a},setViewNode:function(a){this._viewNodeOrID=a},setFullWidthView:function(a){var c=b("DOM").create("div",{className:"_4ck uiTypeaheadView"});b("DOM").setContent(a,c);this.setViewNode(c)},setViewOption:function(a,b){this._viewOptions[a]=b},addTokenizerBehavior:function(a){this._tokenizerBehaviors.push(a)},build:function(a){__p&&__p();var c;if(this._domElement)return;a=b("MercuryTypeaheadTemplates")[":fb:mercury:tokenizer"].build();var d=b("MercuryTypeaheadTemplates")[":fb:mercury:typeahead"].build();this._domElement=a.getRoot();b("DOM").appendContent(this._domElement,d.getRoot());var e=d.getNode("textfield");b("Input").setPlaceholder(e,this._placeholder);e.setAttribute("data-placeholder",this._placeholder);this._input=e;var f={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions};c=(c=this._dataSource)!=null?c.showDefaultList:c;c={ctor:b("MercuryTypeaheadCore"),options:{setValueOnSelect:!0,showDefaultOnNoInput:c,resetOnKeyup:!c}};this._typeahead=new(b("Typeahead"))(this._dataSource,f,c,d.getRoot());this._typeahead.init();f={inline:!0,behaviors:this._tokenizerBehaviors};this._tokenizer=new(b("Tokenizer"))(this._domElement,this._typeahead);this._tokenizer.init(a.getNode("tokenarea"),"participants",[],f);this._tokenizer.subscribe(["addToken","removeToken","removeAllTokens"],this._tokensChanged.bind(this));this._tokenizer.subscribe(["addTokenWithQuery"],this._tokenAdded.bind(this));this._tokenizer.subscribe(["removeToken"],this._tokenRemoved.bind(this));this._tokenizer.subscribe("resize",function(){this.inform("resize")}.bind(this));b("Event").listen(e,"focus",function(){this._resetDataSource(),this._typeahead.init()}.bind(this));b("Event").listen(this._domElement,"click",this.focus.bind(this));b("Event").listen(e,"keydown",this.keydown.bind(this));b("Event").listen(e,"input",this.input.bind(this));this._heightPrev=b("DOMDimensions").getElementDimensions(this._domElement).height},getElement:function(){return this._domElement},getSelectedParticipantIDs:function(){var a=[];this._tokenizer&&(this._tokenizer.getTokenValues()||[]).forEach(function(b){a.push("fbid:"+b)});return a},getTokens:function(){var a=[];this._tokenizer&&(a=this._tokenizer.getTokens());return a},getTokenizer:function(){return this._tokenizer},input:function(a){this.inform("queryChange",{query:a.target.value})},keydown:function(a){__p&&__p();if(this._tokenizer.inline&&a.keyCode==b("Keys").ESC){if(b("Input").isEmpty(this._input)){var c=this._tokenizer.getLastToken();if(c&&c.isRemovable()){this._tokenizer.removeToken(c);a.stopPropagation();return}}else{this._typeahead.getCore().reset();a.stopPropagation();return}this.inform("esc-pressed");return}c=this._typeahead.getView();c=c&&c.index!==-1;if(b("Input").isEmpty(this._input)&&this._tokenizer.inline&&a.keyCode===b("Keys").RETURN){if(b("MercuryConfig").ChatComposer&&c)return;a.preventDefault();return this.inform("tokens-return")}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens(),this._typeahead&&this._typeahead.getCore().reset()},focus:function(){this._tokenizer&&this._tokenizer.focusInput()},getTypeahead:function(){return this._typeahead},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions)},_tokensChanged:function(){this.inform("tokens-changed")},_tokenAdded:function(a,b){this.inform("token-added",b);if(this._dataSource.updateDefaultList!=null){b=(a=b)!=null?(a=a.token)!=null?(a=a.info)!=null?a.uid:a:a:a;this._dataSource.updateDefaultList(b)}},_tokenRemoved:function(a,b){if(this._dataSource.updateDefaultList!=null){a=(a=b)!=null?(a=a.info)!=null?a.uid:a:a;this._dataSource.updateDefaultList(a)}this.inform("token-removed",b)}});e.exports=a}),null);
__d("MercuryTypeaheadRenderer",["cx","Badge.react","CSS","DOM","Event","Image.react","MercuryParticipantsConstants","MercuryTypeaheadTemplates","React","ReactDOM"],(function(a,b,c,d,e,f,g){__p&&__p();function h(a,c){__p&&__p();var d;switch(a.type){case"header":d=b("MercuryTypeaheadTemplates")[":fb:mercury:typeahead:header"].build();h.renderHeader(d,a);break;case"user":case"page":d=b("MercuryTypeaheadTemplates")[":fb:mercury:typeahead:result"].build();h.renderPerson(d,a);break;default:throw new Error("Unsupported result type: "+a.type)}return d.getRoot()}Object.assign(h,{renderHeader:function(a,c){__p&&__p();if(c.disabled){b("CSS").hide(a.getRoot());return}var d=c.getLinkHandler&&c.getLinkHandler();if(d){var e=a.getNode("link");b("DOM").setContent(e,c.linkText);b("Event").listen(e,"click",d)}else b("CSS").hide(a.getNode("link"));a.setNodeContent("text",c.text)},renderPersonWithBigPhoto:function(a,c){i(a,c,b("MercuryParticipantsConstants").BIG_IMAGE_SIZE)},renderPerson:function(a,c){i(a,c,b("MercuryParticipantsConstants").IMAGE_SIZE)},renderPage:function(a,c){i(a,c,b("MercuryParticipantsConstants").IMAGE_SIZE)}});function i(a,c,d){__p&&__p();if(c.photo){d=b("React").jsx(b("Image.react"),{width:d,height:d,src:c.photo});b("ReactDOM").render(d,a.getNode("image"))}c.text&&(b("DOM").setContent(a.getNode("name"),c.text),a.getRoot().setAttribute("aria-label",c.text));d=[];(c.subtext||c.category)&&(c.subtext&&d.push(c.subtext),c.category&&d.push(c.category),b("DOM").appendContent(a.getNode("snippet"),d.join(" \xb7 ")));var e=null;c.is_verified&&(e=b("React").jsx(b("Badge.react"),{type:"verified",size:"xsmall"}),b("ReactDOM").render(e,a.getNode("badge")));if(c.non_employee){d.length&&b("DOM").prependContent(a.getNode("snippet")," \xb7 ");e=b("DOM").create("span",{className:"_52l8 highlight"},"(Non-Employee)");b("DOM").prependContent(a.getNode("snippet"),e)}if(c.render_type==="meeting_room_page"){d={href:"/"+c.uid.toString(),target:"_blank",role:"link"};b("DOM").setAttributes(a.getNode("threadLink"),d)}}e.exports=h}),null);
__d("TabIndexDelegator",["CSS","DOM","Event","Focus","JSXDOM"],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,c){this._placeholder=c||b("JSXDOM").button(null),this._placeholder.setAttribute("aria-hidden",!0),b("CSS").addClass(this._placeholder,"accessible_elem"),this._listener=b("Event").listen(this._placeholder,"click",function(){a.click()}),this._focusRelocator=b("Focus").relocate(this._placeholder,a),this.enable()}var c=a.prototype;c.enable=function(){b("CSS").show(this._placeholder)};c.disable=function(){b("CSS").hide(this._placeholder)};c.getPlaceholder=function(){return this._placeholder};c.destroy=function(){this._listener.remove(),this._focusRelocator.remove(),b("DOM").remove(this._placeholder)};return a}();e.exports=a}),null);
__d("MercuryComposerDialogControl",["csx","fbt","Arbiter","Button","ContextualTypeaheadView","CSS","CurrentUser","Dialog","DialogX","DOM","Input","JSLogger","LayerHideOnTransition","MercuryDataSources","MercuryErrorInfo","MercuryFileUploader","MercuryIDs","MercuryPhotoUploader","MercuryShareLinkUploader","MercuryTypeahead","MercuryTypeaheadRenderer","MercuryMessageActions","MercuryMessageObject","MessengerState.bs","PagesEventObserver","Run","SiteData","SubscriptionsHandler","TabIndexDelegator","MercuryThreadInformer","Token","WorkFileUploadsGating"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i=b("MercuryMessageActions").get(),j=b("MercuryMessageObject").get(),k=b("MercuryThreadInformer").get(),l=b("JSLogger").create("mercury_composer_dialog");function a(a,c,d,e,f,g,i){__p&&__p();var j=this,q;this._dialog=a;this._errorBox=(q=b("DOM")).find(a.getRoot(),"._2oi");this._typeahead=m(this,q.find(a.getRoot(),"._22i"),d);this._textarea=q.find(a.getRoot(),"._2oj");this._sendButton=q.find(a.getRoot(),"._2ok");this._uploadWarning=q.find(a.getRoot(),"._2wj");this._attachButtonForm=q.scry(a.getRoot(),"._212")[0];this._photoButton=q.scry(a.getRoot(),"._214")[0];this._confirmationDialogContent=c;this._entryPoint=g;this._autohide=f;this._ref=i;this._delegator=new(b("TabIndexDelegator"))(this._sendButton);this._attachButtonForm?b("DOM").insertBefore(this._attachButtonForm,this._delegator.getPlaceholder()):this._photoButton&&b("DOM").insertBefore(this._photoButton,this._delegator.getPlaceholder());setTimeout(n.bind(this),0);o.call(this);this._subscriptionsHandler=new(b("SubscriptionsHandler"))();this._subscriptionsHandler.addSubscriptions(this._dialog.subscribe("confirm",function(){p(this)}.bind(this)),this._dialog.subscribe("hide",function(){this._subscriptionsHandler.release()}.bind(this)),k.subscribe("messages-updated",function(a,b){if(this._midWaitingConfirmation)for(var c in b)b[c][this._midWaitingConfirmation]&&u(this)}.bind(this)));d=function(){a.disableBehavior(b("LayerHideOnTransition"))};q=function(){setTimeout(a.enableBehavior.bind(a,b("LayerHideOnTransition")),0)};this._subscriptionsHandler.addSubscriptions(b("Arbiter").subscribe("PhotoSnowlift.OPEN",d),b("Arbiter").subscribe("PhotoSnowlift.CLOSE",q));c=b("DOM").scry(a.getRoot(),".fbVaultEditableGrid")[0];c||(c=b("DOM").find(a.getRoot(),".fbVaultGrid"));c||l.error('Could not find an image grid in the "Send Message" dialog.');this._photoUploader=new(b("MercuryPhotoUploader"))(c,this._photoButton,this._subscriptionsHandler,b("DOM").find(a.getRoot(),"._2qi"));e&&(b("Input").setValue(this._textarea,e),this._shareLinkUploader.check());b("Run").onBeforeUnload(function(){if(!j._dialog.isShown())return null;var a=r(j);return!s(j,a)?null:h._("B\u1ea1n ch\u01b0a ho\u00e0n t\u1ea5t b\u00e0i vi\u1ebft. B\u1ea1n c\u00f3 mu\u1ed1n b\u1ecf d\u1edf kh\u00f4ng?")})}function m(a,c,d){__p&&__p();var e={};e.friend={uid:"friend",type:"header",disabled:!0};e.non_friend={uid:"non_friend",text:h._("Ng\u01b0\u1eddi kh\u00e1c"),type:"header"};e.page={uid:"page",text:h._("Trang"),type:"header"};var f=new(b("MercuryTypeahead"))(b("MercuryDataSources").get("MercuryRecipientsDataSource"),b("ContextualTypeaheadView"));f.setViewOption("renderer",b("MercuryTypeaheadRenderer"));f.setViewOption("typeObjects",e);a._dialog.subscribe("aftershow",function(){f.setFullWidthView(c),f.build(),b("DOM").appendContent(c,f.getElement()),(d||[]).length?(d.forEach(function(c){f.getTokenizer().addToken(new(b("Token"))(c)),c.type=="page"&&x(a,!0)}),a._textarea.focus()):f.focus(),f.getTokenizer().setPlaceholder(h._("T\u00ean"))});return f}function n(){if(b("WorkFileUploadsGating").canUploadFiles){var a=b("DOM").scry(this._dialog.getRoot(),"._4q60 ._n");a.length>0&&(this._fileUploader=new(b("MercuryFileUploader"))(b("DOM").find(this._dialog.getRoot(),"._2qc"),this._attachButtonForm,a[0],b("DOM").find(this._dialog.getRoot(),"._2qd")),this._subscriptionsHandler.addSubscriptions(this._fileUploader.subscribe(["all-uploads-completed","upload-canceled"],w.bind(this))))}this._photoUploader&&this._subscriptionsHandler.addSubscriptions(this._photoUploader.subscribe("all-uploads-completed",w.bind(this)))}function o(){var a;this._shareLinkUploader=new(b("MercuryShareLinkUploader"))((a=b("DOM")).find(this._dialog.getRoot(),"._2v0"),a.find(this._dialog.getRoot(),"._2v1"),a.find(this._dialog.getRoot(),"._2v2"),a.find(this._dialog.getRoot(),"._2v3"),this._textarea)}function p(a){__p&&__p();var b=r(a);if(b.specific_to_list.length&&a._fileUploader&&a._fileUploader.isUploading()){v.call(a);return}if(this._midWaitingConfirmation||!s(a,b)||!b.specific_to_list.length)return null;i.send(b);t(a,b.message_id);q(a,b)}function q(a,c){a._typeahead.getTokens().forEach(function(d){d.getInfo().type==="page"&&b("PagesEventObserver").logData_DEPRECATED({page_id:d.getValue(),event_name:"messages_send_entry_point",entry_point:a._entryPoint,message_id:c.message_id,ref:a._ref,thread_id:c.thread_id},null)})}function r(a){__p&&__p();var c=a._typeahead.getTokens();c=c.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.getValue())});c=j.constructUserGeneratedMessageObject(b("Input").getValue(a._textarea),"source:titan:web",null,c);c.ui_push_phase=b("SiteData").push_phase;c.specific_to_list.length==1&&c.author==c.specific_to_list[0]&&c.specific_to_list.push(c.author);if(a._fileUploader){var d=a._fileUploader.getAttachments();d&&d.length&&(c.has_attachment=!0,c.raw_attachments=d)}a._shareLinkUploader.getAttachData()&&(c.has_attachment=!0,c.shareable_attachment=a._shareLinkUploader.getAttachData());if(a._photoUploader){d=a._photoUploader.getSelectedFBIDs();d.length>0&&(c.has_attachment=!0,c.photo_fbids=d)}if(a._fileUploader){d=a._fileUploader.getImageFiles();d.length>0&&(c.has_attachment=!0,c.image_ids=d);d=a._fileUploader.getVideoFiles();d.length>0&&(c.has_attachment=!0,c.video_ids=d);d=a._fileUploader.getAudioFiles();d.length>0&&(c.has_attachment=!0,c.audio_ids=d);d=a._fileUploader.getFiles();d.length>0&&(c.has_attachment=!0,c.file_ids=d)}return c}function s(a,c){return!b("Input").isEmpty(a._textarea)||c.has_attachment}function t(a,c){a._midWaitingConfirmation=c,b("CSS").hide(a._errorBox),z.bind(a)()}function u(a){__p&&__p();var c=a._midWaitingConfirmation;delete a._midWaitingConfirmation;c=b("MessengerState.bs").getMessagesFromIDs(b("CurrentUser").getID(),[c])[0];if(c&&c.status==1){a._dialog.hide();var d=new(b("DialogX"))({width:b("Dialog").SIZE.STANDARD,autohide:a._autohide,addedBehaviors:[b("LayerHideOnTransition")]},a._confirmationDialogContent);d.show();a._dialog.inform("Messenger/message-sent",{confirmation_dialog:d})}else b("DOM").setContent(a._errorBox,b("MercuryErrorInfo").getMessage(c.error_data)),b("CSS").show(a._errorBox),A.call(a)}function v(){this._blocked=!0,b("CSS").show(this._uploadWarning),z.bind(this)()}function w(){if(this._blocked){if(this._fileUploader&&this._fileUploader.isUploading())return;this._blocked=!1;b("CSS").hide(this._uploadWarning);p(this)}}function x(a,b){b&&(a._typeaheadDisabled=!0);b=a._typeahead.getTypeahead().getCore();b.getElement().setAttribute("disabled","disabled")}function y(a){if(!a._typeaheadDisabled){a=a._typeahead.getTypeahead().getCore();a.getElement().removeAttribute("disabled")}}function z(){x(this,!1),this._textarea.setAttribute("disabled","disabled"),b("Button").setEnabled(this._sendButton,!1),this._delegator.disable()}function A(){y(this),this._textarea.removeAttribute("disabled"),b("Button").setEnabled(this._sendButton,!0),this._delegator.enable()}e.exports=a}),null);
__d("MercuryRecipientsDataSource",["DataSource"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(b,a);function b(b){b=b||{};b.kanaNormalization=!0;return a.call(this,b)||this}var c=b.prototype;c.buildData=function(b){var c=this,d=[],e=[];b.forEach(function(b){var f=a.prototype.getEntry.call(c,b);if(f.render_type=="non_friend"){var g=2;e.length<g&&e.push(b)}else d.length<4&&(f.render_type="friend",d.push(b))});return a.prototype.buildData.call(this,d.concat(e))};return b}(b("DataSource"));e.exports=a}),null);
__d("legacy:CompactTypeaheadRenderer",["CompactTypeaheadRenderer"],(function(a,b,c,d,e,f){a.TypeaheadRenderers||(a.TypeaheadRenderers={}),a.TypeaheadRenderers.compact=b("CompactTypeaheadRenderer")}),3);